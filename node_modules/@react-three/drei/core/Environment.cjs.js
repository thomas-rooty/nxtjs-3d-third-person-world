"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@babel/runtime/helpers/extends"),n=require("react"),r=require("@react-three/fiber"),t=require("three"),u=require("three-stdlib"),o=require("../helpers/environment-assets.cjs.js");function s(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function a(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var t=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(n,r,t.get?t:{enumerable:!0,get:function(){return e[r]}})}})),n.default=e,Object.freeze(n)}var c=s(e),i=a(n);function l(e,n,r,t,u=0){const o=(e=>{return(n=e).current&&n.current.isScene?e.current:e;var n})(n||r),s=o.background,a=o.environment,c=o.backgroundBlurriness||0;return"only"!==e&&(o.environment=t),e&&(o.background=t),e&&void 0!==o.backgroundBlurriness&&(o.backgroundBlurriness=u),()=>{"only"!==e&&(o.environment=a),e&&(o.background=s),e&&void 0!==o.backgroundBlurriness&&(o.backgroundBlurriness=c)}}function d({scene:e,background:n=!1,blur:t,map:u}){const o=r.useThree((e=>e.scene));return i.useLayoutEffect((()=>{if(u)return l(n,e,o,u,t)}),[o,e,u,n,t]),null}function p({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:n="",preset:s,encoding:a,extensions:c}){if(s){if(!(s in o.presetsObj))throw new Error("Preset must be one of: "+Object.keys(o.presetsObj).join(", "));e=o.presetsObj[s],n="https://market-assets.fra1.cdn.digitaloceanspaces.com/market-assets/hdris/"}const i=Array.isArray(e),l=i?t.CubeTextureLoader:u.RGBELoader,d=r.useLoader(l,i?[e]:e,(e=>{e.setPath(n),c&&c(e)})),p=i?d[0]:d;return p.mapping=i?t.CubeReflectionMapping:t.EquirectangularReflectionMapping,p.encoding=(null!=a?a:i)?t.sRGBEncoding:t.LinearEncoding,p}function f({background:e=!1,scene:n,blur:t,...u}){const o=p(u),s=r.useThree((e=>e.scene));return i.useLayoutEffect((()=>l(e,n,s,o,t)),[o,e,n,s,t]),null}function g({children:e,near:n=1,far:u=1e3,resolution:o=256,frames:s=1,map:a,background:c=!1,blur:p,scene:g,files:m,path:b,preset:E,extensions:v}){const h=r.useThree((e=>e.gl)),x=r.useThree((e=>e.scene)),j=i.useRef(null),[k]=i.useState((()=>new t.Scene)),y=i.useMemo((()=>{const e=new t.WebGLCubeRenderTarget(o);return e.texture.type=t.HalfFloatType,e}),[o]);i.useLayoutEffect((()=>(1===s&&j.current.update(h,k),l(c,g,x,y.texture,p))),[e,k,y.texture,g,x,c,s,h]);let O=1;return r.useFrame((()=>{(s===1/0||O<s)&&(j.current.update(h,k),O++)})),i.createElement(i.Fragment,null,r.createPortal(i.createElement(i.Fragment,null,e,i.createElement("cubeCamera",{ref:j,args:[n,u,y]}),m||E?i.createElement(f,{background:!0,files:m,preset:E,path:b,extensions:v}):a?i.createElement(d,{background:!0,map:a,extensions:v}):null),k))}function m(e){var n,t,o,s;const a=p(e),l=e.map||a;i.useMemo((()=>r.extend({GroundProjectedEnvImpl:u.GroundProjectedEnv})),[]);const f=i.useMemo((()=>[l]),[l]),g=null==(n=e.ground)?void 0:n.height,m=null==(t=e.ground)?void 0:t.radius,b=null!==(o=null==(s=e.ground)?void 0:s.scale)&&void 0!==o?o:1e3;return i.createElement(i.Fragment,null,i.createElement(d,c.default({},e,{map:l})),i.createElement("groundProjectedEnvImpl",{args:f,scale:b,height:g,radius:m}))}exports.Environment=function(e){return e.ground?i.createElement(m,e):e.map?i.createElement(d,e):e.children?i.createElement(g,e):i.createElement(f,e)},exports.EnvironmentCube=f,exports.EnvironmentMap=d,exports.EnvironmentPortal=g,exports.useEnvironment=p;
